let to_div,to,sub_to,qu,sub_qu,sub_sub_qu,answ,prev,next,copy_url,results,topics,data,id_to=0,id_qu=0,id_sub_qu=0,qu_stack=[],ans_table={},curry_stack=[],nl2br=t=>t.replace("\n","<br>"),type=(t,e)=>null==t.t&&"s"===e||t.t===e;async function send(){await fetch("/",{method:"post",body:codeAnswers(ans_table)})}function ids_next(t,e,s,n){let i=Object.keys(t);return t[i[e]].q?("g"===t[i[e]].q[s].t?(n++,null==t[i[e]].q[s].q[n]&&(n=0,s++)):s++,null==t[i[e]].q[s]&&(s=0,e++)):e++,[e,s,n]}let chars="0123456789-_abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";speCharsBin={_:"0",x:"10"},speChars=Object.keys(speCharsBin);let charCode=t=>chars.indexOf(t),charFrom=t=>chars.charAt(t);function oct3(t){let e=parseInt(t).toString(2);for(let t=e.length;t<3;++t)e="0"+e;return e}function codeAnswers(t){let e=Object.keys(t),s="",n=0;for(let i=0,l=e.length;i<l;++i){let l=t[e[i]];for(let t=0,e=l.length;t<e;++t){let e=l.charAt(t);if(speChars.includes(e))s+=speCharsBin[e];else if(e.match(/[0-9]/)&&(n=10*n+parseInt(e),!l.charAt(t+1).match(/[0-9]/))){let t=n.toString(8);for(let e=0,n=t.length;e<n;++e)s+="110"+oct3(t.charAt(e));s+="111",n=0}}}let i="";for(let t=0,e=Math.ceil(s.length/6);t<e;++t){let e=s.substr(6*t,6);for(let t=e.length;t<6;++t)e+="0";i+=charFrom(parseInt(e,2))}return i}function decodeAnswers(t,e){let s,n=decoder(e),i=Object.keys(t),l=1,a=0,d=0,o={},r=0,c=n.length,u=[[0,0,0]];for(;r<c&&l<i.length-1;){let e="";for(let d=0,o=s=t[i[l]].q[a].a.length;d<o;d++,r++)if("_"===n.charAt(r))e+="_";else if("x"===n.charAt(r))e+="x";else if(n.charAt(r).match(/([0-9]|\.)/)){for(;"."!==n.charAt(r)&&""!==n.charAt(r);)e+=n.charAt(r),r++;e+="."}else e="";if(e.match(/^_*$/))break;o[[l,a,d]]=e,""!==e&&u.push([l,a,d]);let c=t[i[l]].q[a].a[o[[l,a,d]].indexOf("x")];"object"==typeof c?(l=c.j[0],a=c.j[1]):[l,a,d]=ids_next(t,l,a,d)}return[u,o]}function decoder(t){let e="";for(let s=0,n=t.length;s<n;s++){let n=charCode(t.charAt(s)).toString(2);for(let t=n.length;t<6;t++)n="0"+n;e+=n}let s="";for(let t=0,n=e.length;t<n;)if("0"===e.charAt(t))s+="_",t++;else if("1"===e.charAt(t))if(t++,"0"===e.charAt(t))s+="x",t++;else if(t++,"0"===e.charAt(t)){t++;let n="",i="";do{let s=e.substr(t,3);n+=parseInt(s,2).toString(),i=s=e.substr(t+3,3),t+=6}while("111"!==i);s+=parseInt(n,8),s+="."}return s}function loadQuestion(){let t=topics[id_to],e=t.indexOf("|");to.innerHTML=-1!==e?t.substr(0,e):t,sub_to.innerHTML=-1!==e?t.substr(e+1):"";let s=data[t].c;if(s||(s=[255,255,255]),to_div.style.backgroundColor=`rgb(${s.join(",")})`,data[t].q){let e=data[t].q[id_qu];qu.innerHTML=e.n,sub_qu.innerHTML=null!=e.s?nl2br(e.s):"";let s=e.a;if(type(e,"g")?(e=e.q[id_sub_qu],sub_sub_qu.innerHTML=e):sub_sub_qu.innerHTML="",type(e,"s")||type(e,"m")){let t=type(e,"s")?"radio":"checkbox",n="radio"===t?"checkmark":"checkblock";answ.innerHTML="";for(let e=0,i=s.length;e<i;++e){let i=("object"==typeof s[e]?s[e].n:s[e]).replace("_","<input type='number'>");answ.innerHTML+=`<label class="container"><input type="${t}" name="r">${i}`+`<span class="${n}"></span></label>`}}else type(e,"t")&&(answ.innerHTML='<input type="number">');let n=ans_table[[id_to,id_qu,id_sub_qu]];if(n){let t=0,e=0;if(n.includes("_")||n.includes("x"))for(let s=0,i=n.length;s<i;++s){let i=n.charAt(s);if("_"!==i&&(answ.childNodes[s+e].childNodes[0].checked=!0,"x"!==i&&"."!==i)){let i=n.charAt(s+1);t=10*t+parseInt(i),e--,i&&i.match(/[0-9]/)||(console.log(answ),answ.childNodes[s+e].childNodes[1].value=t)}}else answ.childNodes[0].value=n}}else qu.innerHTML=sub_sub_qu.innerHTML=answ.innerHTML="",sub_qu.innerHTML=data[t].n}function getAnswer(){let t=answ.childNodes,e="";for(let s=0,n=t.length;s<n;++s){let n=t[s];"LABEL"===n.tagName?e+=n.childNodes[0].checked?"INPUT"===n.childNodes[1].tagName?n.childNodes[1].value:"x":"_":"INPUT"===n.tagName&&(e+=n.value+".")}return e}function save_ans(t){ans_table[[id_to,id_qu,id_sub_qu]]=null==t?getAnswer():t}function next_qu(){let t=getAnswer();if(!(t.match(/^_*$/)&&0!==id_to||next.classList.contains("dis"))){save_ans(t),qu_stack.push([id_to,id_qu,id_sub_qu]);let e=null;data[topics[id_to]].q&&data[topics[id_to]].q[id_qu].a&&(e=data[topics[id_to]].q[id_qu].a[t.indexOf("x")])&&(e=e.j),e?[id_to,id_qu]=e:[id_to,id_qu,id_sub_qu]=ids_next(data,id_to,id_qu,id_sub_qu),prev.classList.remove("dis"),id_to===topics.length-1&&(next.innerHTML="Submit"),loadQuestion();let s=curry_stack.pop(),n=!1;for(;void 0!==s&&!n;)s[0]!==id_to||s[1]!==id_qu||s[2]!==id_sub_qu?(delete ans_table[s],s=curry_stack.pop()):n=!0}}function prev_qu(){prev.classList.contains("dis")||(save_ans(),curry_stack.push([id_to,id_qu,id_sub_qu]),[id_to,id_qu,id_sub_qu]=qu_stack.pop(),"Submit"===next.innerHTML&&(next.innerHTML="&gt;&gt;"),next.classList.remove("dis"),0===qu_stack.length&&prev.classList.add("dis"),loadQuestion())}window.addEventListener("load",async()=>{let t=t=>document.querySelector(t);to_div=t("body > div:first-child"),to=t("h1"),sub_to=t("body > div:first-child > h2"),qu=t("body > div:last-child > h2"),sub_qu=t("body > div:last-child > h4"),sub_sub_qu=t("body > div:last-child > h3"),answ=t("body > div:last-child > div > div"),prev=t("body > div:last-child > button:first-of-type"),next=t("body > div:last-child > button:last-of-type"),copy_url=t("body > div:first-child > button:first-of-type"),results=t("body > div:first-child > button:last-of-type");let e=document.getElementsByTagName("body")[0];data=await fetch("/json/q.json").then(t=>t.json()),topics=Object.keys(data);let s=window.location.href,n=s.substr(s.lastIndexOf("/")+1);if(""!==n){let t=decodeAnswers(data,n),e=Object.keys(t[1]);ans_table=t[1],[id_to,id_qu,id_sub_qu]=e[e.length-1].split(","),qu_stack=t[0]}prev.addEventListener("click",prev_qu),next.addEventListener("click",()=>{"Submit"===next.innerHTML?(send(),next.classList.add("dis")):next_qu()}),copy_url.addEventListener("click",()=>{const t=document.createElement("textarea");t.value="http://vps613152.ovh.net/"+codeAnswers(ans_table),t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}),results.addEventListener("click",async()=>{let t=await fetch("/results").then(t=>t.text()).then(t=>t.split("\n"));e.innerHTML="";for(let s=0,n=t.length;s<n;++s){let n=decodeAnswers(data,t[s])[1],i=Object.keys(n);console.log(n);for(let t=0,e=i.length;t<e;++t);e.innerHTML+=JSON.stringify(n)+"<br>"}}),loadQuestion()});